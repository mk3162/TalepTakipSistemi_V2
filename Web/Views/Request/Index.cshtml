@using Microsoft.AspNetCore.Http
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@*@model IEnumerable<Common.Models.Response.ResponseTaleplerIslemListesiDto>*@
@model Common.Models.Response.ResponseKullanicilarListesiDto
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/_AdminLayout.cshtml";
}
<style>
    .form-group {
        margin-bottom: 0.5rem;
    }
</style>
<partial name="_AddTopMenuPartialView" />

<div class="row col-lg-12">
    <a href="#" id="NewRequest" class="btn btn-info btn-xs" tabindex="0" aria-controls="example1" type="button" data-toggle="modal" data-target=".bd-talep-modal-lg" style="margin-left:1120px;">Yeni Talep</a>
</div>


<div class="panel-body" style="margin-top:5px;">
    <table id="example" class="table table-bordered table-striped dataTable dtr-inline display" cellspacing="0" width="100%">
        <thead>
            <tr>
                <th></th>
                <th>Talep No</th>
                <th>Talep Sahibi</th>
                <th>Ürün</th>
                <th>Miktar</th>
                <th>Birim</th>
                <th>Birim Fiyat</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

<partial name="_ProcessModalPartialView" />

<div class="modal fade bd-fiyat-modal-lg" id="PriceModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            @using (Html.BeginForm("AddRequest", "Request", FormMethod.Post))
            {
                <div class="modal-body">
                    <div class="form-group">
                        <label for="message-text" class="col-form-label" required="required">Birim Fiyat</label>
                        <input type="number" name="UnitPrice" class="form-control-sm" style="width: 300px; margin-left:85px;" />
                        <select style="width:150px;display:inline-block; margin-left:10px;" class="form-control" id="CurrencyIslem"></select>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label" required="required">Toplam Fiyat</label>
                        <input type="text" name="TotalPrice" class="form-control-sm" style="width: 300px; margin-left:70px;" disabled="disabled" />
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">Tedarikçi</label>
                        <select style="width:460px; display: inline-block; margin-left:100px;" class="form-control" id="SupplierIslem"></select>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">Hedef Teslim Tarihi</label>
                        <input type="date" name="DeliveryDate" class="form-control-sm" style="width: 300px; margin-left:25px;" />
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="form-group">
                        <button type="button" class="btn btn-danger" data-dismiss="modal" style="color: white; font-weight: bold; margin-right:380px;">Vazgeç</button>
                        <button id="Send" type="submit" class="btn btn-success" style="color:white; font-weight: bold; margin-right:475px;">Kaydet</button>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<div class="modal fade bd-yorum-modal-lg" id="CommentModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            @using (Html.BeginForm("AddRequest", "Request", FormMethod.Post))
            {
                <div class="modal-body">
                    <div class="form-group">
                        <label for="message-text" class="col-form-label" required="required">İşlem Yapacak</label>
                        <select style="width:450px;display:inline-block; margin-left:10px;" class="form-control" id="ProcessorIslem"></select>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label" required="required">Yorumunuz</label>
                    </div>
                    <div class="form-group">
                        <textarea class="form-control-lg" name="Comment" id="Comment" style="width:570px; height:50px;"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="form-group">
                        <button type="button" class="btn btn-danger" data-dismiss="modal" style="color: white; font-weight: bold; margin-right:380px;">Vazgeç</button>
                        <button id="Send" type="submit" class="btn btn-success" style="color:white; font-weight: bold; margin-right:535px;">Tamam</button>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<div class="modal fade bd-onayred-modal-lg" id="ApproveRejectModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            @using (Html.BeginForm("AddRequest", "Request", FormMethod.Post))
            {
                <div class="modal-body">
                    <div class="form-group">
                        <label for="message-text" class="col-form-label" required="required">Yorumunuz</label>
                    </div>
                    <div class="form-group">
                        <textarea class="form-control-lg" name="Comment" id="Comment" style="width:570px; height:50px;"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="form-group">
                        <button type="button" class="btn btn-danger" data-dismiss="modal" style="color: white; font-weight: bold; margin-right:380px;">Vazgeç</button>
                        <button id="Send" type="submit" class="btn btn-success" style="color:white; font-weight: bold; margin-right:535px;">Tamam</button>
                    </div>

                </div>
            }
        </div>
    </div>
</div>

<partial name="_EditModalPartialView" />
<partial name="_RequestModalPartialView" />

<script src="~/TalepWeb/plugins/jquery/jquery.min.js"></script>

<script src="~/js/DropDownFillFunc/Düzelt/DuzeltDropDown.js"></script>
<script src="~/js/DropDownFillFunc/Islem/IslemDropDown.js"></script>
<script src="~/js/DropDownFillFunc/Talep/TalepDropDown.js"></script>

<script src="~/js/DropDownFillFunc/Düzelt/DuzeltTipDropDown.js"></script>
<script src="~/js/DropDownFillFunc/Islem/IslemTipDropDown.js"></script>
<script src="~/js/DropDownFillFunc/Talep/TalepTipDropDown.js"></script>

<script src="~/js/DropDownFillFunc/Düzelt/DuzeltUrunDropDown.js"></script>
<script src="~/js/DropDownFillFunc/Talep/TalepUrunDropDown.js"></script>

<script src="~/js/DropDownFillFunc/Düzelt/DuzeltParaBirimDropDown.js"></script>
<script src="~/js/DropDownFillFunc/Islem/IslemParaBirimDropDown.js"></script>
<script src="~/js/DropDownFillFunc/Talep/TalepParaBirimDropDown.js"></script>

<script src="~/js/DropDownFillFunc/Düzelt/DuzeltBirimDropDown.js"></script>
<script src="~/js/DropDownFillFunc/Talep/TalepBirimDropDown.js"></script>

<script src="~/js/DropDownFillFunc/Islem/IslemTedarikciDropDown.js"></script>

<script src="~/js/DropDownFillFunc/Düzelt/DuzeltTalepDropDown.js"></script>
<script src="~/js/DropDownFillFunc/Islem/IslemTalepDropDown.js"></script>
<script src="~/js/DropDownFillFunc/Talep/TalepTalepDropdown.js"></script>
<script src="~/js/DropDownFillFunc/Islem/IslemKontrolYonlendirTalepDropDown.js"></script>

<script src="~/js/AddListFunctions/Talep/TalepAddFileFunc.js"></script>
<script src="~/js/AddListFunctions/Talep/TalepAddProductFunc.js"></script>

<script src="~/js/AddListFunctions/Duzelt/DuzeltAddFileFunc.js"></script>

<script src="~/js/DeleteListExtensions/DeleteFromTable.js"></script>


<script>
    function Gizle() {
        $("#altListe").hide();
    }

    function CalculateTalep() {
        var a = document.getElementById('AmountRequest').value;
        var b = document.getElementById('UnitPriceRequest').value;
        var result = parseFloat(a) * parseFloat(b);
        if (!isNaN(result)) {
            document.getElementById('TotalPriceRequest').value = result;
        }
    }

    function CalculateDuzelt() {
        var a = document.getElementById('AmountEdit').value;
        var b = document.getElementById('UnitPriceEdit').value;
        var result = parseFloat(a) * parseFloat(b);
        if (!isNaN(result)) {
            document.getElementById('TotalPriceEdit').value = result;
        }
    }

    function format(d) {
        // `d` is the original data object for the row
        return '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">' +
            '<thead style="background-color:burlywood; color:white;">' +
            '<tr class="info">' +
            '<th style="width:300px;">Zaman</th>' +
            '<th style="width:300px;">İşlem Yapan</th>' +
            '<th style="width:300px;">Yapılan İşlem</th>' +
            '<th style="width:700px;">Açıklama/Yorum</th>' +
            '</tr>' +
            '</thead>' +
            '<tr>' +
            '<td>' + d.islemZamani + '</td>' +
            '<td>' + d.islemYapanAdi + '</td>' +
            '<td>' + d.yapilanIslem + '</td>' +
            '<td>' + d.Aciklama + '</td>' +
            '</tr>' +
            '<tr>' +
            '<td>' + d.islemZamani + '</td>' +
            '<td>' + d.islemYapanAdi + '</td>' +
            '<td>' + d.yapilanIslem + '</td>' +
            '<td>' + d.Aciklama + '</td>' +
            '</tr>' +
            '<tr>' +
            '<td>' + d.islemZamani + '</td>' +
            '<td>' + d.islemYapanAdi + '</td>' +
            '<td>' + d.yapilanIslem + '</td>' +
            '<td>' + d.Aciklama + '</td>' +
            '</tr>' +
            '<tr>' +
            '<td>' + d.islemZamani + '</td>' +
            '<td>' + d.islemYapanAdi + '</td>' +
            '<td>' + d.yapilanIslem + '</td>' +
            '<td>' + d.Aciklama + '</td>' +
            '</tr>' +
            '</table>';
    }


    $(document).ready(function () {
        var table = $('#example').DataTable({
            ajax: {
                url: "/Request/GetRequestProcessList",
                dataSrc: ""
            },
            columns: [
                {
                    'className': 'details-control',
                    'orderable': false,
                    'data': null,
                    "render": function (data, type, row) {
                         let url = '@Url.Action("GetRequestPeriodList", "Request")/' + row.talepSiraNo;
                         let url2 = '@Url.Action("UpdateRequest", "Request")/' + row.talepSiraNo;
                        return '<a id="Process" onclick="IslemModalShow(' + row.talepSiraNo + ')" class="btn btn-primary btn-xs" style="color:white;">İşlem</a>' +
                            "<a href='" + url + "' class='btn btn-default btn-xs' id='Period' style='color:white; background-color:burlywood;'>Süreç Gör</a> " +

                            "<a id='Edit' onclick='DuzeltModalShow(" + row.talepSiraNo + ")' class='btn btn-success btn-xs'> Düzelt</a> ";
},
                    'defaultContent': ''
                },
                { "data": 'talepSiraNo' },
                { "data": 'talepSahibiAdi' },
                { "data": 'urunTanimi' },
                { "data": 'miktar' },
                { "data": 'miktarBirim' },
                { "data": 'birimFiyat' }
            ],
            'order': [[1, 'asc']],
            "responsive": true,
            "dom": '<"html5buttons"B>lTfgitp',
            "language": {
                "emptyTable": "Gösterilecek ver yok.",
                "processing": "Veriler yükleniyor",
                "sDecimal": ".",
                "sInfo": "_TOTAL_ kayıttan _START_ - _END_ arasındaki kayıtlar gösteriliyor",
                "sInfoFiltered": "(_MAX_ kayıt içerisinden bulunan)",
                "sInfoPostFix": "",
                "sInfoThousands": ".",
                "sLengthMenu": "Sayfada _MENU_ kayıt göster",
                "sLoadingRecords": "Yükleniyor...",
                "sSearch": "Ara:",
                "sZeroRecords": "Eşleşen kayıt bulunamadı",
                "oPaginate": {
                    "sFirst": "İlk",
                    "sLast": "Son",
                    "sNext": "Sonraki",
                    "sPrevious": "Önceki"
                },
                "oAria": {
                    "sSortAscending": ": artan sütun sıralamasını aktifleştir",
                    "sSortDescending": ": azalan sütun sıralamasını aktifleştir"
                },
                "select": {
                    "rows": {
                        "_": "%d kayıt seçildi",
                        "0": "",
                        "1": "1 kayıt seçildi"
                    }
                }
            }
        });

        // Add event listener for opening and closing details
        $('#example tbody').on('click', 'td.details-control', function () {
            var tr = $(this).closest('tr');
            var row = table.row(tr);

            if (row.child.isShown()) {
                // This row is already open - close it
                row.child.hide();
                tr.removeClass('shown');
            } else {
                // Open this row
                row.child(format(row.data())).show();
                tr.addClass('shown');
            }
        })
    });
    function DuzeltModalShow(id) {
        $('#EditModal').modal('show');
    }

    function IslemModalShow(id) {
        $('#ProcessModal').modal('show');
    }
</script>
